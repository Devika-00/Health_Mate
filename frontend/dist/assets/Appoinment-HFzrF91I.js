import{b as q,u as K,r as l,l as z,j as e,U as x,N as J}from"./index-CPlNsI3o.js";import{N as Y}from"./navbar-BHmEPp3G.js";import{a as b}from"./axiosService-fZoXDBrJ.js";import{l as H,C as Q,M as k}from"./index-DVIpHlwK.js";import{s as f}from"./toaster-B89phBrG.js";import{D as X}from"./react-datepicker-C_fXRuwI.js";import"./index-TrmL613C.js";import"./iconBase-4W9_WsNC.js";import"./axios-Cm0UX6qg.js";import"./index-VWaDGczM.js";import"./index-BKNjMPK8.js";import"./format-HzG6idBM.js";import"./parseISO-BGTP3Fcq.js";const L=()=>{const{id:c}=q(),C=K(),[u,P]=l.useState(null),[A,y]=l.useState(!1),[$,h]=l.useState(!1),[o,p]=l.useState({patientName:"",patientAge:"",patientNumber:"",patientGender:""}),[i,j]=l.useState(null),[d,N]=l.useState([]),[g,I]=l.useState(null),[m,T]=l.useState(null),[w,E]=l.useState([]),O=z(a=>a.UserSlice.id);l.useEffect(()=>{(async()=>{try{const t=await b.get(`${x}/doctor/${c}`);P(t.data.doctor)}catch(t){console.error("Error fetching doctor details:",t)}})()},[c]),l.useEffect(()=>{j(new Date)},[]),l.useEffect(()=>{(async()=>{if(i)try{const t=await b.get(`${x}/timeslots/${c}?date=${i.toISOString()}`);if(t.data.timeSlots.length>0){const s=i.getDay(),n=t.data.timeSlots[0].slots.find(r=>r.day===s);N(n?n.times.map(r=>`${r.start} - ${r.end}`):[])}else N([])}catch(t){console.error("Error fetching time slots:",t)}})()},[i,c]),l.useEffect(()=>{(async()=>{try{const t=await b.get(`${x}/bookings/${O}`);E(t.data.data.bookingDetails)}catch(t){console.error("Error fetching bookings:",t)}})()},[c]);function S(a){const t=new Date(a),s=t.getMonth()+1,n=t.getDate(),r=t.getFullYear();return`${s}/${n}/${r}`}const M=H("pk_test_51PD7KTSIzXVKkSTfUhacmtu4D3bCdX2OCgy7mCYS0JJVvro7cM8QwwIoQVHcBlCEg41UUlqIplqs0avKVML03Bnc00iATAKl4Y"),B=async()=>{try{const a={doctorId:c,patientDetails:m||o,consultationType:"Offline",fee:400,paymentStatus:"Pending",appoinmentStatus:"Booked",appoinmentCancelReason:"",date:S(i),timeSlot:g},t=await b.post(`${x}/appointments`,a);if(t.data.id){const s=await M,n=await(s==null?void 0:s.redirectToCheckout({sessionId:t.data.id}));n!=null&&n.error&&console.error(n.error);const r=t.data.booking.bookingId;J({to:`${x}/payment_status/${r}?success=true`})}else f(t.data.message,"error")}catch(a){console.error("Error booking appointment:",a),f("Error booking appointment. Please try again later.","error")}},G=async()=>{try{const a={doctorId:c,patientDetails:m||o,consultationType:"Offline",fee:400,paymentStatus:"Pending",appoinmentStatus:"Booked",appoinmentCancelReason:"",date:S(i),timeSlot:g},t=await b.post(`${x}/walletPayment`,a);if(t.data.success){const s=t.data.createBooking._id;C(`/payment_status/${s}?success=true`)}else f(t.data.message,"error")}catch(a){console.log(a)}},F=()=>{g?y(!0):f("Please select a time slot","error")},v=()=>{y(!1)},D=a=>{const{name:t,value:s}=a.target;if(t==="patientName"){const n=s.replace(/[^a-zA-Z ]/g,"").replace(/\b\w/g,r=>r.toUpperCase());p({...o,[t]:n})}else if(t==="patientAge"){const n=s.replace(/\D/g,"");p({...o,[t]:n})}else if(t==="patientNumber"){const n=s.replace(/\D/g,"").slice(0,10);p({...o,[t]:n})}else p({...o,[t]:s})},R=a=>{const{name:t,value:s}=a.target;p({...o,[t]:s})},V=()=>{h(!0)},U=a=>{h(!0),p(a),y(!1)},_=()=>{o.patientName&&o.patientAge&&o.patientGender?(h(!1),y(!1),T(o)):f("Please fill in all fields","error")},W=a=>{I(g===a?null:a)};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Book an Appointment"}),u&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center mb-8",children:[e.jsx("img",{src:u.profileImage,alt:u.doctorName,className:"w-40 h-40 md:w-60 md:h-60 rounded mb-4 md:mb-0 md:mr-4"}),e.jsxs("div",{className:"ml-0 md:ml-8 text-center md:text-left",children:[e.jsx("h2",{className:"text-xl font-bold",children:u.doctorName}),e.jsx("p",{children:u.department}),e.jsx("p",{className:"text-green-600 font-semibold",children:"Verified"}),e.jsxs("div",{className:"text-gray-800 bg-blue-100 p-4 rounded-md mt-5 font-bold",children:[e.jsx("p",{className:"mb-2",children:"Consultation: Offline"}),e.jsx("p",{children:"Fee: 400/-"})]})]}),e.jsx("div",{className:"flex justify-center mb-8 md:ml-8 w-full md:w-auto mt-5",children:e.jsx("iframe",{src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3929.9542915875227!2d76.32012407479272!3d9.937761290164516!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3b087303f27ba213%3A0xd163e2ff8e59c028!2sP%20S%20Mission%20Hospital!5e0!3m2!1sen!2sin!4v1715065874858!5m2!1sen!2sin",width:"400",height:"300",style:{border:"0"},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"ml-4 mt-6 font-medium text-blue-950 text-lg",children:"Select The Scheduled Date"}),e.jsx(X,{selected:i,onChange:a=>j(a),className:"rounded-lg px-4 py-2 w-full mt-2",dateFormat:"MM/dd/yyyy",minDate:new Date,placeholderText:"Select Date",customInput:e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"border shadow-2xl border-gray-900 rounded-lg px-4 py-2 w-full font-medium text-gray-900",value:i?i.toDateString():"",readOnly:!0,placeholder:"Select Date"}),e.jsx(Q,{className:"absolute right-3 top-3 text-gray-800 cursor-pointer mr-3"})]})})]}),d.length>0?e.jsxs("div",{className:"max-w-md mx-auto lg:mx-0 lg:mr-auto lg:w-1/3",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Schedule Time Slots"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:d.map((a,t)=>e.jsx("button",{className:`w-full rounded-md py-3 border border-blue-900 px-4 text-sm font-medium ${g===a?"bg-blue-900 text-white":"bg-white text-gray-700 hover:bg-gray-200"} shadow-md`,onClick:()=>W(a),children:a},t))})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-red-600 mt-4 text-lg",children:"The doctor is on leave"}),e.jsx("p",{className:"text-red-600 mt-4",children:"No slots scheduled for the selected date."})]}),e.jsxs(k,{isOpen:A,onRequestClose:v,style:{overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},content:{position:"relative",top:"auto",left:"auto",right:"auto",bottom:"auto",width:"90%",maxWidth:"400px",borderRadius:"8px",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",padding:"20px",margin:"0 auto"}},children:[e.jsx("button",{onClick:v,className:"absolute top-0 right-0 m-4 bg-gray-400 p-2 rounded",children:"close"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Patient Details"}),w.length>0?w.map((a,t)=>e.jsxs("div",{className:"border rounded-lg p-4 mb-4 cursor-pointer",onClick:()=>U(a),children:[e.jsxs("p",{children:["Name: ",a.patientName]}),e.jsxs("p",{children:["Age: ",a.patientAge]}),e.jsxs("p",{children:["Gender: ",a.patientGender]})]},t)):e.jsx("p",{className:"mb-4",children:"No existing patient details"}),e.jsx("button",{onClick:V,className:"bg-blue-950 text-white py-2 px-4 rounded-lg mr-2",children:"Add Details +"})]}),e.jsxs(k,{isOpen:$,onRequestClose:()=>h(!1),style:{overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},content:{position:"relative",top:"auto",left:"auto",right:"auto",bottom:"auto",width:"90%",maxWidth:"400px",borderRadius:"8px",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",padding:"20px",margin:"0 auto"}},children:[e.jsx("button",{onClick:()=>h(!1),className:"absolute top-0 right-0 m-4 bg-gray-400 p-2 rounded",children:"close"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Enter Patient Details"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"Name:"}),e.jsx("input",{type:"text",name:"patientName",value:o.patientName,onChange:D,className:"border border-gray-400 rounded-lg px-4 py-2 w-full mt-1"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"Age:"}),e.jsx("input",{type:"text",name:"patientAge",value:o.patientAge,onChange:D,className:"border border-gray-400 rounded-lg px-4 py-2 w-full mt-1"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"Gender:"}),e.jsxs("select",{name:"patientGender",value:o.patientGender,onChange:R,className:"border border-gray-400 rounded-lg px-4 py-2 w-full mt-1",children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"others",children:"Others"})]})]}),e.jsx("button",{onClick:_,className:"bg-blue-950 text-white py-2 px-4 rounded-lg mt-4",children:"Submit"})]})]}),e.jsx("div",{className:"mt-8",children:m?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"border border-gray-500 p-4 rounded-md",children:[e.jsx("h2",{className:"font-bold mb-3 text-lg",children:"Patient Details"}),e.jsxs("p",{children:["Name: ",m.patientName]}),e.jsxs("p",{children:["Age: ",m.patientAge]}),e.jsxs("p",{children:["Gender: ",m.patientGender]})]})}):e.jsx("div",{})}),e.jsx("div",{className:"flex flex-col md:flex-row justify-start mt-8",children:m?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:B,disabled:d.length===0,className:`bg-blue-950 text-white py-2 px-4 rounded-lg mb-2 md:mb-0 ${d.length===0?"opacity-50 cursor-not-allowed":""}`,children:"Online Payment"}),e.jsx("button",{onClick:G,disabled:d.length===0,className:`bg-blue-950 text-white py-2 px-4 rounded-lg md:ml-5 ${d.length===0?"opacity-50 cursor-not-allowed":""}`,children:"Wallet Payment"})]}):e.jsx("button",{onClick:F,disabled:d.length===0,className:`bg-blue-950 text-white py-2 px-4 rounded-lg ${d.length===0?"opacity-50 cursor-not-allowed":""}`,children:"Book an Appointment"})})]})},pe=()=>e.jsxs(e.Fragment,{children:[e.jsx(Y,{}),e.jsx(L,{})]});export{pe as default};
